(()=>{"use strict";var e={569:(e,t,r)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.YMapClusterer=void 0;const s=r(508),o=r(272),n=r(146),a=Object.freeze({tickTimeout:s.THROTTLE_DEFAULT_TIMEOUT_MS});class l extends ymaps3.YMapComplexEntity{constructor(e){super(e),this._entitiesCache={},this._visibleEntities={},this._render=this._render.bind(this)}_isVisible(e,t,r){const{x:i,y:s}=r.toWorldCoordinates(e.geometry.coordinates),{x:o,y:n}=r.toWorldCoordinates(t[0]),{x:a,y:l}=r.toWorldCoordinates(t[1]);return o<=i&&n>=s&&a>=i&&l<=s}_getEntity({lnglat:e,features:t,clusterId:r}){let i=this._entitiesCache[r];return i||(i=1===t.length?this._props.marker(t[0]):this._props.cluster(e,t),this._entitiesCache[r]=i),i}_getVisibleEntities(e){const t={};return e.forEach((e=>{const r=this._getEntity(e);t[e.clusterId]=r})),t}_syncVisibleEntities(e){for(const t in this._visibleEntities)e[t]||this._container.removeChild(this._visibleEntities[t]);for(const t in e)this._visibleEntities[t]||this._container.addChild(e[t])}_render({mapInAction:e}={}){const t=this.root;if(!t||e)return;const r=this._props.features.filter((e=>this._isVisible(e,t.bounds,t.projection))),i=this._props.method.render({map:t,features:r});if(this._props.onRender&&!1===this._props.onRender(i))return;const s=this._getVisibleEntities(i);this._syncVisibleEntities(s),this._visibleEntities=s}__implGetDefaultProps(){return l.defaultProps}_onAttach(){this._entitiesCache={},this._visibleEntities={},this._container=new ymaps3.YMapCollection({}),this.addChild(this._container);const e=this._props.tickTimeout?(0,o.throttle)(this._render,this._props.tickTimeout):this._render;this._mapListener=new ymaps3.YMapListener({onUpdate:e,onResize:e}),this.addChild(this._mapListener),this._render()}_onDetach(){this.removeChild(this._container),this.removeChild(this._mapListener),this._entitiesCache={},this._visibleEntities={}}_onUpdate(){this._render()}}t.YMapClusterer=l,i=ymaps3.overrideKeyReactify,l.defaultProps=a,l[i]=n.YMapClustererReactifyOverride},508:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.THROTTLE_DEFAULT_TIMEOUT_MS=void 0,t.THROTTLE_DEFAULT_TIMEOUT_MS=200},272:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=void 0,t.throttle=(e,t)=>{let r,i,s;return function(){const o=this,n=arguments;r?(clearTimeout(i),i=setTimeout((()=>{Date.now()-s>=t&&(e.apply(o,n),s=Date.now())}),Math.max(t-(Date.now()-s),0))):(e.apply(o,n),s=Date.now(),r=!0)}}},482:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertPixelSizeToWorldSize=t.divn=void 0,t.divn=function(e,t,r={x:0,y:0}){return r.x=e.x/t,r.y=e.y/t,r},t.convertPixelSizeToWorldSize=function(e,t,r){const i=2**t/2*256;return function(e,t,r={x:0,y:0}){return r.x=e.x/t.x,r.y=e.y/t.y,r}(e,{x:i,y:-i},r)}},500:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(599),t),s(r(569),t),s(r(713),t)},599:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},786:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clusterByGrid=void 0;const i=r(482);class s{constructor(e){this._nextFeatureIndex=0,this._featureIdCharCache={},this._gridSize=e}_getClusterSizeWorld(e){return(0,i.convertPixelSizeToWorldSize)({x:this._gridSize,y:0},e).x}_computeVisibleClusters(e,t,r){const s=(0,i.divn)((0,i.convertPixelSizeToWorldSize)(e,t),2),o=r.y+s.y,n=r.y-s.y,a=r.x-s.x,l=r.x+s.x,c=this._getClusterSizeWorld(t),u=Math.floor(a/c),d=Math.ceil(l/c),h=Math.floor(o/c),_=Math.ceil(n/c),p=new Map;for(let e=u;e<=d;e++)for(let t=h;t<=_;t++)p.set(`${e}-${t}`,!0);return p}_clusterize(e,t,r){const i=new Map,s=this._getClusterSizeWorld(r);for(const r of t){const t={world:e.projection.toWorldCoordinates(r.geometry.coordinates),lnglat:r.geometry.coordinates,clusterId:"",features:[r]},o=`${Math.floor(t.world.x/s)}-${Math.floor(t.world.y/s)}`;let n=i.get(o);n||(n={sumX:0,sumY:0,objects:[],features:[]},i.set(o,n)),n.sumX+=t.world.x,n.sumY+=t.world.y,n.objects.push(t),n.features.push(t.features[0])}return i}_generateClusterId(e){const t=["cluster-"];return e.forEach((({id:e})=>{this._featureIdCharCache[e]||(this._featureIdCharCache[e]=String.fromCharCode(this._nextFeatureIndex),this._nextFeatureIndex+=1),t.push(this._featureIdCharCache[e])})),t.join("")}render({map:e,features:t}){const r=Math.round(e.zoom),i=this._computeVisibleClusters(e.size,r,e.projection.toWorldCoordinates(e.center)),s=this._clusterize(e,t,r),o=[];for(const[t,r]of s.entries()){if(!i.get(t))continue;const s=r.objects.length;if(1===s)o.push({...r.objects[0],clusterId:r.features[0].id});else{const t={x:r.sumX/s,y:r.sumY/s};o.push({world:t,lnglat:e.projection.fromWorldCoordinates(t),clusterId:this._generateClusterId(r.features),features:r.features})}}return o}}t.clusterByGrid=function({gridSize:e}){return new s(e)}},713:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clusterByGrid=void 0;var i=r(786);Object.defineProperty(t,"clusterByGrid",{enumerable:!0,get:function(){return i.clusterByGrid}})},146:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.YMapClustererReactifyOverride=void 0,t.YMapClustererReactifyOverride=(e,{reactify:t,React:r})=>{const i=t.entity(e);return r.forwardRef(((e,t)=>{const[s,o]=r.useState([]),n=r.useCallback((t=>{const i={};return t.forEach((({lnglat:t,features:s,clusterId:o})=>{i[o]=r.createElement(r.Fragment,{key:o},1===s.length?e.marker(s[0]):e.cluster(t,s))})),o(Object.values(i)),!1}),[e]);return r.createElement(r.Fragment,null,r.createElement(i,{...e,ref:t,onRender:n}),s)}))}},341:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,s)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(500),t)}},t={},r=function r(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,r),o.exports}(341);self["@yandex/ymaps3-clusterer"]=r})();